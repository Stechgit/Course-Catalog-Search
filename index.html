<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

</head>
<!------------------------->
<!--BACKGROUND AND IMAGES-->
<!------------------------->

<body style="background-color:#4f2984">
    <div class="card col-12 border-0 mh-25" style="background-color:#333333">
        <div class="col-lg-1 col-md-2 col-sm-3">
            <img src="img/TECH_Logo_Horizontal_TransparentBkgd_Gold.png" class="img-fluid mw-5 mh-5" alt="Tn Tech Logo">
        </div>
    </div>
    <div style="background-color:#4f2984" class="col-md-2 col-lg-2 col-sm-2 col-xs-2 mx-auto mt-5 mb-3 rounded-circle"
        id="techSeal">
        <img src="img/TechSignatureSeal_TransparentBkgd_Gold.png" class="img-fluid mw-5 mh-5" alt="Tn Tech Seal">
    </div>

    <!------------------------->
    <!---COURSE SEARCH CARD---->
    <!------------------------->
    <div class="card mt-5 col-6 mx-auto text-center" style="background-color:#FFCC33" id="divSearch">
        <div class="card-body d-flex justify-content-center">
            <div class="card-title">
                <h2 class="mt-0 mb-0" style="color: #4f2984;"> Course search</h2>
            </div>

        </div>
        <div class="px-2">
            <div class="form-group">
                <select class="form-control" id="txtSemester" aria-label="Term">
                    <option value="0">Select Semester</option>
                    <option value="80">Fall</option>
                    <option value="10">Spring</option>
                    <option value="50">Summer</option>
                </select>

            </div>
            <div class="form-group mt-2">
                <input type="text" placeholder="Year" class="form-control" id="txtYear" aria-label="Year">

            </div>
            <div class="form-group mt-2">
                <input type="text" placeholder="Department" class="form-control" id="txtDepartment"
                    aria-label="Department">

            </div>
            <div class="form-group mt-2 mb-2">
                <input type="text" placeholder="Course Number" class="form-control" id="txtCourse" aria-label="Course">

            </div>
            <div class="form-group mt-2 mb-2">
                <input type="text" placeholder="Building" class="form-control" id="txtBuilding" aria-label="Building">

            </div>
            <div class="form-group mt-2 mb-2">
                <input type="text" placeholder="Start Time" class="form-control" id="txtStartTime"
                    aria-label="Start Time">

            </div>

            <div class="form-group mt-2 mb-2">
                <input type="text" placeholder="End Time" class="form-control" id="txtEndTime" aria-label="End Time">

            </div>
            <div class="form-group mt-2 mb-2">
                <button type="button" id="btnSearch" style="background-color:#333333; color:#FFCC33;"
                    class="col-4 rounded">Search</button>
                <button type="button" id="btnReset" style="background-color:#333333; color:#FFCC33;"
                    class="col-4 rounded">Reset</button>
            </div>
            <div class="form-group mt-2 mb-2">

            </div>
        </div>
    </div>
    <!-------------------------->
    <!--MAXIMUM STUDENTS CARDS-->
    <!-------------------------->
    <div class="col-10 mx-auto mt-3 mb-0 d-none" id="divMaxCard">
        <div class="d-flex col-12 mb-0 ">
            <div class="card col-2 pt-1 px-2 rounded-top-left-1 "
                style="text-shadow: 0.5px 0.5px #4f2984;   text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#262626; color:#FFCC33  ">
                <h3>Monday</h3>
                <h5 id="txtMondayMaxStudents">Max Students:</h5>
                <h5 id="txtMondayMaxTime">Time:</h5>
            </div>
            <div class="card col-2 pt-1 px-2 padding  rounded-0 "
                style="text-shadow: 0.5px 0.5px #4f2984;  text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#333333; color:#FFCC33  ">
                <h3>Tuesday</h3>
                <h5 id="txtTuesdayMaxStudents">Max Students:</h5>
                <h5 id="txtTuesdayMaxTime">Time:</h5>
            </div>
            <div class="card col-2 pt-1 px-2  rounded-top-right-1 rounded-0 "
                style="text-shadow: 0.5px 0.5px #4f2984; text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#262626; color:#FFCC33 ">
                <h3>Wednesday</h3>
                <h5 id="txtWednesdayMaxStudents">Max Students:</h5>
                <h5 id="txtWednesdayMaxTime">Time:</h5>
            </div>

            <div class="card col-2 pt-1 px-2 hover rounded-0 "
                style="text-shadow: 0.5px 0.5px #4f2984;  text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#333333; color:#FFCC33  ">
                <h3>Thursday</h3>
                <h5 id="txtThursdayMaxStudents">Max Students:</h5>
                <h5 id="txtThursdayMaxTime">Time:</h5>
            </div>
            <div class="card col-2 pt-1 px-2  rounded-0 "
                style="text-shadow: 0.5px 0.5px #4f2984;  text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#262626; color:#FFCC33 ">
                <h3>Friday</h3>
                <h5 id="txtFridayMaxStudents">Max Students:</h5>
                <h5 id="txtFridayMaxTime">Time:</h5>
            </div>

            <div class="card col-2 pt-1 px-2  rounded-top-right-1 "
                style="text-shadow: 0.5px 0.5px #4f2984;  text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#333333; color:#FFCC33  ">
                <h3>Weekly</h3>
                <h5 id="txtMaxWeeklyStudents">Max Students:</h5>
                <h5 id="txtMaxWeekday"></h5>

            </div>
        </div>
    </div>



    <!------------------------->
    <!-----TABLE HEADER-------->
    <!------------------------->
    <div class="card mt-0 text-center col-10 mx-auto d-none" style="background-color:#333333;" id="tableClasses">
        <table style="color:#FFCC33;" class="table table-dark hoverTable table-striped col-10 mx-auto" id="tblResults">
            <thead style="position: sticky;top: 0px;">

                <th>
                    <h5>Course</h5>
                </th>
                <th>
                    <h5>Meeting Days</h5>
                </th>
                <th>
                    <h5>Meeting Times</h5>
                </th>
                <th>
                    <h5>Location</h5>
                </th>
                <th>
                    <h5>Students</h5>
                </th>
                <th>
                    <h5>Credits</h5>
                </th>
                <th>
                    <h5>Start Time</h5>
                </th>
                <th>
                    <h5>End Time</h5>
                </th>
                <th>
                    <div class="form-group mt-2 mb-2">
                        <button type="button" id="btnNewSearch"
                            style="text-shadow: #333333; text-decoration: solid; border-color: #4f2984; background-color:#FFCC33; color:#4f2984  "
                            class="col-10 rounded">
                            <h5>New Search</h5>
                        </button>
                    </div>
                </th>

            </thead>
            <tbody>

            </tbody>
        </table>
    </div>

    <!------------------------->
    <!----------CDN'S--------->
    <!------------------------->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



    <script>
        //*******************//
        //**Button Reset*****//
        //*******************//
        //Clears the forms in Course Search
        $('#btnReset').on('click', function () {
            let strSemester = $('#txtSemester').val('0'); // in #btnReset 
            let strYear = $('#txtYear').val('');
            let strDepartment = $('#txtDepartment').val('');
            let strCourse = $('#txtCourse').val('');
            let strBuilding = $('#txtBuilding').val('');

        })

        //*******************//
        //**Button Search****//
        //*******************//
        //Takes inputs from user and begins searching for classes with filters
        $('#btnSearch').on('click', function () {
            var arrCourses;
            let strSemester = $('#txtSemester').val();
            if (strSemester != '10' && strSemester != '50' && strSemester != '80') { // in #btnSearch
                console.log($('#txtSemester').val())
                Swal.fire({
                    icon: 'error',
                    title: 'Required Input',
                    text: 'Please enter a valid Semester',
                })
                return 0;
            }
            let strTerm = $('#txtYear').val() + strSemester;
            console.log(strTerm);
            strDepartment = $('#txtDepartment').val().toUpperCase();
            strCourse = $('#txtCourse').val().toUpperCase();
            strBuilding = $('#txtBuilding').val().toUpperCase();
            $('#divSearch').slideUp();
            $('#techSeal').addClass('rotating');
            $('#tableClasses').removeClass('d-none');
            strStartTime = $('#txtStartTime').val()
            strEndTime = $('#txtEndTime').val();

            //GetJSON builds url to access api
            let strUrl = $.getJSON('https://portapi.tntech.edu/express/api/unprotected/getCourseInfoByAPIKey.php?', { Key: '5B2FB0FC-79F6-47FF-839D-DA910DD9D17D', Term: strTerm, Subject: strDepartment, Course: strCourse, Building: strBuilding }, function (result) {
                $('#tableClasses tbody').empty();
                arrCourses = result;
                
                //Checks for start time and end time.  
                if (strStartTime.length > 0) {
                    result = result.filter(function (el) {
                        let intTime = parseInt(strStartTime);
                        return parseInt(el.STARTTIME) <= strStartTime // Between the start time & end time // Has the required amount of open slots or greater
                    });
                } if (strEndTime.length > 0) {
                    result = result.filter(function (el) {
                        let intTime = parseInt(strEndTime);
                        return parseInt(el.ENDTIME) >= strEndTime 
                    });
                }
                
                //Iterates through an array, for each course found it adds a row to the table.
                $.each(result, function (index, course) {
                    let strHTML = '';  //starts at empty string bc we want to += as we go, if we don't it we be undefined
                    strCourseDepartment = course.DEPARTMENT
                    if (strCourseDepartment.length == 0) {

                    }
                    strHTML += '<tr>';
                    strHTML += '<td>' + course.DEPARTMENT + course.COURSE + '-' + course.SECTION + ' ' + course.TITLE + '</td>';
                    if (course.CLASSDAYS) {
                        strHTML += '<td>' + course.CLASSDAYS + ' </td>';
                    } else {
                        strHTML += '<td>N/A</td>';
                    }
                    if (course.STARTTIME) {
                        strHTML += '<td>' + course.STARTTIME + '-' + course.ENDTIME + '</td>';
                    } else {
                        strHTML += '<td>N/A</td>';
                    }
                    if (course.BUILDING && course.ROOM) {
                        strHTML += '<td>' + course.BUILDING + ' ' + course.ROOM + '</td>';

                    } else if (course.BUILDING) {
                        strHTML += '<td>' + course.BUILDING + '</td>'
                    } else {
                        strHTML += '<td>N/A</td>'
                    }
                    strHTML += '<td>' + course.STUDENTCOUNT + ' </td>';
                    if (course.CREDITS) {
                        strHTML += '<td>' + course.CREDITS + ' </td>';
                    } else {
                        strHTML += '<td>N/A</td>';
                    }

                    if (course.STARTAM_PM == 'pm') {
                        let strStartTime = '';
                        if (course.STARTTIME > 1299) {
                            strStartTime = String(course.STARTTIME - 1200);
                        } else {
                            strStartTime = course.STARTTIME;
                        }
                        if (strStartTime[0] == 0) {
                            strStartTime = strStartTime.substring(1);
                        }
                        let intLength = strStartTime.length;
                        strHTML += '<td>' + strStartTime.substring(0, intLength - 2) + ':' + strStartTime.substring(intLength - 2) + ' PM</td>';
                    } else if (course.STARTAM_PM == 'am') {
                        let strStartTime = course.STARTTIME;
                        if (strStartTime[0] == 0) {
                            strStartTime = strStartTime.substring(1);
                        }
                        let intLength = strStartTime.length;
                        strHTML += '<td>' + strStartTime.substring(0, intLength - 2) + ':' + strStartTime.substring(intLength - 2) + ' AM</td>';

                    } else {
                        strHTML += '<td>N/A</td>';
                    }
                    if (course.ENDAM_PM == 'pm') {
                        let strEndTime = '';
                        if (course.ENDTIME > 1299) {
                            strEndTime = String(course.ENDTIME - 1200);
                        } else {
                            strEndTime = course.ENDTIME;
                        }
                        if (strEndTime[0] == 0) {
                            strEndTime = strEndTime.substring(1);
                        }
                        let intLength = strEndTime.length;
                        strHTML += '<td>' + strEndTime.substring(0, intLength - 2) + ':' + strEndTime.substring(intLength - 2) + ' PM</td>';
                    } else if (course.ENDAM_PM == 'am') {
                        let strEndTime = course.ENDTIME;
                        if (strEndTime[0] == 0) {
                            strEndTime = strEndTime.substring(1);
                        }
                        let intLength = strEndTime.length;
                        strHTML += '<td>' + strEndTime.substring(0, intLength - 2) + ':' + strEndTime.substring(intLength - 2) + ' AM</td>';

                    } else {
                        strHTML += '<td>N/A</td>';
                    }
                    strHTML += '<td>' + '' + '</td>';
                    strHTML += '</tr>';
                    $('#tblResults tbody').append(strHTML);
                    $('#divMaxCard').removeClass('d-none');
                    $('#tableClasses').removeClass('d-none');
                    $('#tableClasses').slideDown();
                    $('#techSeal').removeClass('rotating')

                    //------------------------------------

                })

                //This code finds the highest volume of students for each day
                //The first 5 elements in the array are the highest volume of students for each day
                //The last 5 elements in the array are the timeslots  for each day that are the busiest
                //i.e. element 0 is monday maximum students, emement 5 is monday maximum timeslot
                let StudentCountArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

                for (let j = 0; j < 5; j++) {
                    let objCourseDayFilter = result;
                    let strWeekDay = '';
                    switch (j) {
                        case 0:
                            strWeekDay = 'M';
                            break;
                        case 1:
                            strWeekDay = 'T';
                            break;
                        case 2:
                            strWeekDay = 'W';
                            break;
                        case 3:
                            strWeekDay = 'R';
                            break;
                        case 4:
                            strWeekDay = 'F';
                            break;
                    }
                    let forStartTime = 800;
                    let forEndTime = 2100;
                    if (strStartTime.length > 0) {
                        forStartTime = strStartTime;
                    }
                    if (strEndTime.length > 0) {
                        forEndTime = forEndTime;
                    }

                    for (let i = forStartTime; i < forEndTime; i += 100) {
                        let intTotalStudents = 0;
                        tempCompare = i;
                        let objCourseTimeFilter = objCourseDayFilter;
                        objCourseTimeFilter = objCourseTimeFilter.filter(element => (parseInt(element.STARTTIME) <= i) && (parseInt(element.ENDTIME) >= i) && (element.CLASSDAYS.includes(strWeekDay)));
                        console.log(objCourseTimeFilter);
                        objCourseTimeFilter.forEach(function (element) {
                            intTotalStudents += element.STUDENTCOUNT;
                        })
                        //the code below adds colons into the time.
                        if (StudentCountArray[j] < intTotalStudents) {
                            StudentCountArray[j] = intTotalStudents;
                            StudentCountArray[j + 5] = String(i);
                            if (StudentCountArray[j + 5] > 1299) {
                                StudentCountArray[j + 5] = String(StudentCountArray[j + 5] - 1200);
                                countLength = StudentCountArray[j + 5].length;
                                StudentCountArray[j + 5] = StudentCountArray[j + 5].substring(0, countLength - 2) + ':' + StudentCountArray[j + 5].substring(countLength - 2) + ' PM';

                            } else if (StudentCountArray[j + 5] > 1199) {

                                countLength = StudentCountArray[j + 5].length;
                                StudentCountArray[j + 5] = StudentCountArray[j + 5].substring(0, countLength - 2) + ':' + StudentCountArray[j + 5].substring(countLength - 2) + ' PM';
                            } else {
                                countLength = StudentCountArray[j + 5].length;
                                StudentCountArray[j + 5] = StudentCountArray[j + 5].substring(0, countLength - 2) + ':' + StudentCountArray[j + 5].substring(countLength - 2) + ' AM';
                            }

                        }


                    }
                }
                //This code clears the data for maximum students and time cards
                console.log(StudentCountArray);
                $('#txtMondayMaxStudents').empty();
                $('#txtMondayMaxTime').empty();

                $('#txtTuesdayMaxStudents').empty();
                $('#txtTuesdayMaxTime').empty();

                $('#txtWednesdayMaxStudents').empty();
                $('#txtWednesdayMaxTime').empty();

                $('#txtThursdayMaxStudents').empty();
                $('#txtThursdayMaxTime').empty();

                $('#txtFridayMaxStudents').empty();
                $('#txtFridayMaxTime').empty();

                $('#txtMaxWeeklyStudents').empty();
                $('#txtMaxWeeklyTime').empty();
                $('#txtMaxWeekday').empty();

                //this code appends data for maximum students and time cards
                $('#txtMondayMaxStudents').append('Max Students: ' + StudentCountArray[0]);
                $('#txtMondayMaxTime').append('Time: ' + StudentCountArray[5]);

                $('#txtTuesdayMaxStudents').append('Max Students: ' + StudentCountArray[1]);
                $('#txtTuesdayMaxTime').append('Time: ' + StudentCountArray[6]);

                $('#txtWednesdayMaxStudents').append('Max Students: ' + StudentCountArray[2]);
                $('#txtWednesdayMaxTime').append('Time: ' + StudentCountArray[7]);

                $('#txtThursdayMaxStudents').append('Max Students: ' + StudentCountArray[3]);
                $('#txtThursdayMaxTime').append('Time: ' + StudentCountArray[8]);

                $('#txtFridayMaxStudents').append('Max Students: ' + StudentCountArray[4]);
                $('#txtFridayMaxTime').append('Time: ' + StudentCountArray[9]);
                let getMaxStudents = (Math.max(StudentCountArray[0], StudentCountArray[1], StudentCountArray[2], StudentCountArray[3], StudentCountArray[4]));

                //This code figures out which weekday is the maximum weekly
                $('#txtMaxWeeklyStudents').append('Max Students: ' + getMaxStudents);
                if (getMaxStudents == StudentCountArray[0]) {
                    let getMaxTime = StudentCountArray[5];


                    $('#txtMaxWeekday').append('Monday ' + getMaxTime + ' ');
                   
                }
                if (getMaxStudents == StudentCountArray[1]) {
                    let getMaxTime = StudentCountArray[6];
                    $('#txtMaxWeekday').append('Tuesday ' + getMaxTime + ' ');
                   
                }
                if (getMaxStudents == StudentCountArray[2]) {
                    let getMaxTime = StudentCountArray[7];
                    $('#txtMaxWeekday').append('Wednesday ' + getMaxTime + ' ');
                   
                }
                if (getMaxStudents == StudentCountArray[3]) {
                    let getMaxTime = StudentCountArray[8];
                    $('#txtMaxWeekday').append('Thursday ' + getMaxTime + ' ');
                    
                }
                if (getMaxStudents == StudentCountArray[4]) {
                    let getMaxTime = StudentCountArray[9];
                    $('#txtMaxWeekday').append('Friday ' + getMaxTime + ' ');
                    
                }

            })
               
        })
    </script>
    
    <script>
        //*******************//
        //**New Search*******//
        //*******************//'
        //Toggles course search window and scrolls user to top
        $('#btnNewSearch').on('click', function () {
           
            $('#divSearch').slideDown();
            window.scrollTo(0, 0);
        })

    </script>
    <!------------------------->
    <!-------CSS STYLES-------->
    <!------------------------->
    <style>
        /*Rotates images*/
        .rotating {
            animation: rotate 1s infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <style>
        /*Rounds one corner*/
        .rounded-top-left-1 {
            border-top-left-radius: 1rem;
            border-top-right-radius: 0rem;
            border-bottom-right-radius: 0rem;
            border-bottom-left-radius: 0rem;
        }

        .rounded-top-right-1 {
            border-top-left-radius: 0rem;
            border-top-right-radius: 1rem;
            border-bottom-right-radius: 0rem;
            border-bottom-left-radius: 0rem;
        }

        .rounded-bottom-left-1 {
            border-top-left-radius: 0rem;
            border-top-right-radius: 0rem;
            border-bottom-right-radius: 0rem;
            border-bottom-left-radius: 1rem;
        }

        .rounded-bottom-right-1 {
            border-top-left-radius: 0rem;
            border-top-right-radius: 0rem;
            border-bottom-right-radius: 1rem;
            border-bottom-left-radius: 0rem;
        }
    </style>
    <style>
        /*adds colors to hovering over rows in a table*/
        .hoverTable {
            width: 100%;
            border-collapse: collapse;
        }

        .hoverTable td {
            padding: 7px;
            border-bottom: #4f2984 1px solid;
        }

        /* Define the default color for all the table rows */
        .hoverTable tr {
            background-color: #6b76d1;
        }

        /* Define the hover highlight color for the table row */
        .hoverTable tr:hover {
            background-color: #9aa3ed;
            color: #a456ba;
        }
    </style>

</body>

</html>
